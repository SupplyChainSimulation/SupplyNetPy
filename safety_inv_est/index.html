<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://supplychainsimulation.github.io/SupplyNetPy/safety_inv_est/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Estimating Safety Stock - SupplyNetPy</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Estimating Safety Stock";
        var mkdocs_page_input_path = "safety_inv_est.md";
        var mkdocs_page_url = "/SupplyNetPy/safety_inv_est/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SupplyNetPy
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ten_min/">SupplyNetPy in 10 Minutes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Basic</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../example/">Supply Chain With Factory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../example-newvendor/">News Vendor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../EOQ_est/">Estimating EOQ</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Estimating Safety Stock</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#system-description">System Description</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#numerical-example">Numerical Example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#results">Results</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Advanced</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../example-complex/">Complex Supply Chain</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../case_study_pharma/">Pharmacy Supply Chain</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-core/">Core Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-utilities/">Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-logger/">Logger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../known-issues/">Known Issues and Planned Work</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SupplyNetPy</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Examples</li>
          <li class="breadcrumb-item">Basic</li>
      <li class="breadcrumb-item active">Estimating Safety Stock</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <style> 
img{
  width:75%;
}
</style>
<p><small>This example is from the textbook 
<b>Supply Chain Management: Strategy, Planning, and Operation, (Chopra and Meindl)</b>
</small><br>
<small>Find the Google Colab notebook for this example <a href="https://colab.research.google.com/drive/17xD4b5Pf03gV5HYhwCd31SGgo3Pkgczo?usp=sharing" target="_blank">here</a>.</small></p>
<h1 id="estimating-safety-stock-level">Estimating Safety Stock Level</h1>
<p>Safety inventory can help a supply chain improve product availability in the presence of supply and demand variability.</p>
<p><img alt="image.png" src="../img/safety_inv_est_files/safety_inv_est_profile.png" /></p>
<p><small> Image source: [Textbook] Supply Chain Management: Strategy, Planning, and Operation, (Chopra and Meindl) </small></p>
<h2 id="system-description">System Description</h2>
<p><strong>Bloomingdale</strong> sells Gucci purses. Demand is 100 per week. Gucci takes 3 weeks to deliver purses to Bloomingdale in response to an order. Therfore Bloomingdale can place an order when exactly 300 purses are remaining in the inventory.</p>
<p>Given deand fluctuations, demand over three weeks may be higher or lower than that of 300. If it is higher, Bloomingdale will lose sales. The store manager decides to put an order of 400 purses (therfore, safety level is 100).</p>
<p><strong>Goal:</strong> To determine the appropriate level of safety inventory.</p>
<p><strong>Replinishment policies:</strong></p>
<ol>
<li>
<p><strong>Continuous review:</strong> Inventory is continuously tracked, and an order for a lot size Q is placed when the inventory declines to the reorder point (ROP). As an example, consider the store manager at B&amp;M who continuously tracks the inventory of phones. She orders 600 phones when the inventory drops below ROP 400. In this case, the size of the order does not change from one order to the next. The time between orders may fluctuate given variable demand.</p>
</li>
<li>
<p><strong>Periodic review:</strong> Inventory status is checked at regular periodic intervals, and an order is placed to raise the inventory level to a specified threshold. As an example, consider the purchase of film at B&amp;M. The store manager does not track film inventory continuously. Every Thursday, employees check film inventory, and the manager orders enough so that the total of the available inventory and the size of the order equals 1,000 films. In this case, the time between orders is fixed. The size of each order, however, can fluctuate given variable demand.</p>
</li>
</ol>
<h2 id="numerical-example">Numerical Example</h2>
<p style="font-size: 20px;"><b>Evaluating Safety Inventory, Given an Inventory Policy</b></p>

<p>Assume that weekly demand for phones at B&amp;M Office Supplies is normally distributed, with a mean of 2,500 and a standard deviation of 500. The manufacturer takes two weeks to fill an order placed by the B&amp;M manager. The store manager currently orders 10,000 phones when the inventory on hand drops to 6,000. Evaluate the safety inventory and the average inventory carried by B&amp;M. Also evaluate the average time a phone spends at B&amp;M.</p>
<p><strong>Analytical Solution:</strong><br>
Under this replenishment policy, we have <br>
Average demand per week, <span class="arithmatex">\(D = 2500\)</span> <br>
Standard deviation of weekly demand, <span class="arithmatex">\(\sigma_D = 500\)</span> <br>
Average lead tme for replenishment, <span class="arithmatex">\(L = 2\)</span> Weeks <br>
Reorder point <span class="arithmatex">\(ROP = 6000\)</span> <br>
Average lot size <span class="arithmatex">\(Q = 10000\)</span> <br></p>
<p>using eq 12.3 in the textbook,</p>
<p>safety inv, <span class="arithmatex">\(ss = ROP - D^*L = 6000-5000 = 1000\)</span> <br>
B&amp;M thus carries a safety inventory of 1,000 phones.<br></p>
<p>Cycle inventory = <span class="arithmatex">\(\frac{Q}{3} = \frac{10000}{2} = 5000\)</span></p>
<p>Average inventory = cycle inventory + safety inventory <span class="arithmatex">\(= 5000 + 1000 = 6000\)</span></p>
<p>Average flow time = average inventory/throughput <span class="arithmatex">\(= \frac{6000}{2500} = 2.4\)</span> weeks</p>
<p><strong>System:</strong></p>
<p><img alt="image.png" src="../img/safety_inv_est_files/safety_inv_est_sc.png" /></p>
<p>Cost per unit, transportation cost is not given. So we can assume anything. We want to find<br> </p>
<ul>
<li>Safety inventory level (the average number of phones on hand when a replenishment order arrives).</li>
<li>Cycle inventory (average inventory levels) </li>
<li>Average flowtime (average time spent by a product in the inventory)</li>
</ul>
<h2 id="implementation">Implementation</h2>
<pre><code class="language-python">import simpy
import numpy as np
import matplotlib.pyplot as plt
import SupplyNetPy.Components as scm

daily_demand_mean = 2500/7
daily_demand_std = 500/(7**0.5)
simlen = 3650 # simulation length in days

def normal_quantity():
    global daily_demand_mean, daily_demand_std
    sample = -1
    while sample &lt; 0:
        sample = np.random.normal(daily_demand_mean, daily_demand_std, 1)[0]
    return sample

env = simpy.Environment()
# create an infinite supplier
supplier1 = scm.Supplier(env=env, ID=&quot;S1&quot;, name=&quot;Supplier1&quot;, node_type=&quot;infinite_supplier&quot;)
#create the distributor
distributor1 = scm.InventoryNode(env=env, ID=&quot;D1&quot;, name=&quot;Distributor1&quot;, node_type=&quot;distributor&quot;, capacity=float('inf'), initial_level=6000, inventory_holding_cost=0.1,
                                product_buy_price=0, replenishment_policy=scm.RQReplenishment, policy_param={'R':6000,'Q':10000}, product_sell_price=399)
link1 = scm.Link(env=env,ID=&quot;l1&quot;, source=supplier1, sink=distributor1, cost=100, lead_time=lambda: 14)
demand1 = scm.Demand(env=env,ID=&quot;d1&quot;, name=&quot;demand_d1&quot;, order_arrival_model=lambda: 1, order_quantity_model=normal_quantity, demand_node=distributor1)
scm.global_logger.disable_logging() # disable logging
env.run(until=simlen)

# calculate performance metrics
safety_stock = []
replenish_cycles = [0]

inv_levels = np.array(distributor1.inventory.instantaneous_levels) # instantaneous inventory levels
# lets calculate safety stock level
for i in range(len(inv_levels)-1):
    if(inv_levels[i,1]&lt;inv_levels[i+1,1]): # inventory level is increasing that means a replenishment order is received
        safety_stock.append(inv_levels[i,1])
        replenish_cycles.append(inv_levels[i,0]) # time of replenishment order

# calculate average flow time (amount of time an item is stored in inventory)
flow_time = []
for i in range(len(replenish_cycles)-1):
    flow_time.append(replenish_cycles[i+1]-replenish_cycles[i])

print(&quot;\n\t***\nSafety Stock Level: &quot;, np.mean(safety_stock))
print(&quot;Average Inventory Level:&quot;, np.mean(inv_levels[:,1]))
print(&quot;Average Flow Time: &quot;, np.mean(flow_time)/2, &quot;days&quot;,&quot;\n&quot;)

# plot the inventory level over time
plt.plot(inv_levels[:,0], inv_levels[:,1], marker='.', label=&quot;Inventory Level&quot;, color='green', linestyle='')
plt.axhline(y=6000, color='r', linestyle='--', label=&quot;ROP&quot;)
plt.xlabel(&quot;Time (days)&quot;)
plt.ylabel(&quot;Inventory Level&quot;)
plt.title(&quot;Inventory Level over Time&quot;)
plt.legend()
plt.grid()
plt.show()
</code></pre>
<pre><code>    ***
Safety Stock Level:  1315.2294619614904
Average Inventory Level: 6207.3688497299245
Average Flow Time:  13.57089552238806 days
</code></pre>
<p><img alt="png" src="../img/safety_inv_est_files/safety_inv_est_2_1.png" /></p>
<p>Since the demand at the B&amp;M office is unpredictable, we will estimate the safety inventory by conducting multiple simulations. First, we will define a function to simulate the B&amp;M office sales. We will then use this function to run several simulations.</p>
<pre><code class="language-python">def bnmoffice():
    env = simpy.Environment()

    # create an infinite supplier
    supplier1 = scm.Supplier(env=env, ID=&quot;S1&quot;, name=&quot;Supplier1&quot;, node_type=&quot;infinite_supplier&quot;)

    #create the distributor
    distributor1 = scm.InventoryNode(env=env, ID=&quot;D1&quot;, name=&quot;Distributor1&quot;, node_type=&quot;distributor&quot;, capacity=16000, initial_level=6000, inventory_holding_cost=0.1,
                                    product_buy_price=0, replenishment_policy=scm.SSReplenishment, policy_param={'s':6000,'S':16000}, product_sell_price=399)

    link1 = scm.Link(env=env,ID=&quot;l1&quot;, source=supplier1, sink=distributor1, cost=100, lead_time=lambda: 14)

    demand1 = scm.Demand(env=env,ID=&quot;d1&quot;, name=&quot;demand_d1&quot;, order_arrival_model=lambda: 1, order_quantity_model=normal_quantity, demand_node=distributor1)

    scm.global_logger.disable_logging() # disable logging
    env.run(until=simlen)

    # calculate performance metrics
    safety_stock = []
    replenish_cycles = [0]

    inv_levels = np.array(distributor1.inventory.instantaneous_levels) # instantaneous inventory levels
    # lets calculate safety stock level
    for i in range(len(inv_levels)-1):
        if(inv_levels[i,1]&lt;inv_levels[i+1,1]): # inventory level is increasing that means a replenishment order is received
            safety_stock.append(inv_levels[i,1])
            replenish_cycles.append(inv_levels[i,0]) # time of replenishment order

    # calculate average flow time (amount of time an item is stored in inventory)
    flow_time = []
    for i in range(len(replenish_cycles)-1):
        flow_time.append(replenish_cycles[i+1]-replenish_cycles[i])

    return np.mean(safety_stock), np.mean(inv_levels[:,1]), np.mean(flow_time)/2

num_simulations = 100
ana_arr = [] # let us gather all stats in this variable
for i in range(0,num_simulations):
    ana_arr.append([])
    safety_stock, avg_inv, flow_t = bnmoffice()
    ana_arr[-1].extend([safety_stock, avg_inv, flow_t])

ana_arr = np.array(ana_arr) # convert to array for convenience
#Final Stats
print(&quot;\n\t***\nSafety Stock Level: Mean: &quot;, np.mean(ana_arr[:,0]), &quot; Std:&quot;, np.std(ana_arr[:,0]))
print(&quot;Average Inventory Level:&quot;, np.mean(ana_arr[:,1]), &quot; Std:&quot;,  np.std(ana_arr[:,1]))
print(&quot;Average Flow Time: &quot;, np.mean(ana_arr[:,2]), &quot;days&quot;,&quot;\n&quot;, &quot; Std:&quot;,  np.std(ana_arr[:,2]))
</code></pre>
<p><br></p>
<h2 id="results">Results</h2>
<pre><code>    ***
Safety Stock Level: Mean:  1347.9523813366336  Std: 54.85624022638165
Average Inventory Level: 6315.472134834441  Std: 42.11831759963809
Average Flow Time:  13.820451583252883 days 
  Std: 0.1074252955034431
</code></pre>
<p>We obtain a slightly higher safety level, and average inventory levels from the simulation because sampling from a normal distribution can yield a few values less than zero. In our method, <code>normal_quantity()</code>, we resample in such cases to ensure that we only get numbers that are greater than or equal to zero, as negative demand is not possible. This resampling increases the probability of obtaining positive values. We will demonstrate this further below.</p>
<pre><code class="language-python">def normal_quantity():
    &quot;&quot;&quot;
    Normal Distribution with given mean, and std
    A new sample is generated for every negative sample
    &quot;&quot;&quot;
    global daily_demand_mean, daily_demand_std
    sample = -1
    while sample &lt; 0:
        sample = np.random.normal(daily_demand_mean, daily_demand_std, 1)[0]
    return sample

def normal_quantity_mean():
    &quot;&quot;&quot;
    Normal Distribution with given mean, and std
    The mean value replaces a negative sample
    &quot;&quot;&quot;
    global daily_demand_mean, daily_demand_std
    sample = np.random.normal(daily_demand_mean, daily_demand_std, 1)[0]
    if sample &lt; 0:
        sample = daily_demand_mean
    return sample

def normal_quantity_wn():
    &quot;&quot;&quot;
    Normal Distribution with given mean, and std including negatives
    &quot;&quot;&quot;
    global daily_demand_mean, daily_demand_std
    sample = np.random.normal(daily_demand_mean, daily_demand_std, 1)[0]
    return sample

samples = []
samples_wn = []
samples_mean = []
for r in range(5000):
    samples.append(normal_quantity())
    samples_wn.append(normal_quantity_wn())
    samples_mean.append(normal_quantity_mean())

plt.figure(figsize=(5, 3))
plt.hist(samples, bins=50, density=True, alpha=0.5, color='blue', label='Normal without negatives')
plt.title('Normal')
plt.xlabel('Quantity')
plt.ylabel('Density')
plt.grid()
plt.legend()

plt.figure(figsize=(5, 3))
plt.hist(samples_wn, bins=50, density=True, alpha=0.5, color='green', label='Normal with negatives')
#plt.title('Normal without negative quantities')
plt.xlabel('Quantity')
plt.ylabel('Density')
plt.grid()
plt.legend()

plt.figure(figsize=(5, 3))
plt.hist(samples_mean, bins=50, density=True, alpha=0.5, color='red', label='Normal: replace mean for negatives')
#plt.title('Normal with mean for negative quantities')
plt.xlabel('Quantity')
plt.ylabel('Density')
plt.grid()
plt.legend()
</code></pre>
<p><img alt="png" src="../img/safety_inv_est_files/safety_inv_est_6_1.png" /></p>
<p><img alt="png" src="../img/safety_inv_est_files/safety_inv_est_6_2.png" /></p>
<p><img alt="png" src="../img/safety_inv_est_files/safety_inv_est_6_3.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../EOQ_est/" class="btn btn-neutral float-left" title="Estimating EOQ"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../example-complex/" class="btn btn-neutral float-right" title="Complex Supply Chain">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../EOQ_est/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../example-complex/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://supplychainsimulation.github.io/SupplyNetPy/example-complex/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Complex Supply Chain - SupplyNetPy</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Complex Supply Chain";
        var mkdocs_page_input_path = "example-complex.md";
        var mkdocs_page_url = "/SupplyNetPy/example-complex/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SupplyNetPy
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ten_min/">SupplyNetPy in 10 Minutes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >Basic</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../example/">Supply Chain With Factory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../example-newvendor/">News Vendor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../EOQ_est/">Estimating EOQ</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../safety_inv_est/">Estimating Safety Stock</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Advanced</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Complex Supply Chain</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#goals">Goals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-concepts-used">Key Concepts Used</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#full-example">Full Example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sample-output">Sample Output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#suggested-experiments">Suggested Experiments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../case_study_pharma/">Pharmacy Supply Chain</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-core/">Core Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-utilities/">Utilities</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api-reference/api-ref-logger/">Logger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../known-issues/">Known Issues and Planned Work</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SupplyNetPy</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Examples</li>
          <li class="breadcrumb-item">Advanced</li>
      <li class="breadcrumb-item active">Complex Supply Chain</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="complex-supply-chain-network">Complex Supply Chain Network</h1>
<p>This example demonstrates how to build and simulate a multiâ€‘echelon, hybrid supply chain with different replenishment policies in <strong>SupplyNetPy</strong>.</p>
<p><img alt="Newsvendor" src="../img/bread_sc.png" /></p>
<h2 id="goals">Goals</h2>
<ul>
<li>Creating a network with multiple raw materials, suppliers, a manufacturer, two distributors, and several retailers.</li>
<li>Mix replenishment policies (`SS`, `RQ`, `Periodic`).</li>
<li>Include hybrid connections (ordering from multiple distributors).</li>
</ul>
<h2 id="key-concepts-used">Key Concepts Used</h2>
<ul>
<li><strong>Products, Raw Materials</strong>: Class <code>Product</code> used to create a product, Bread, with some shelf life, <code>RawMaterial</code> is used to create raw materials (dough, sugar, yeast)</li>
<li><strong>Nodes</strong>: Clasees <code>Supplier</code>, <code>Manufacturer</code>, <code>InventoryNode</code> are used to create suppliers,  bakery (factory), distributors, and retailers (cake shops).</li>
<li><strong>Links</strong>: Class <code>Link</code> is used to link different nodes in the network</li>
<li><strong>Policies</strong>:<ul>
<li><code>SSReplenishment</code>: order up to <strong>S</strong> when inventory &lt;= <strong>s</strong></li>
<li><code>RQReplenishment</code>: reorder point <strong>R</strong>, fixed order quantity <strong>Q</strong></li>
<li><code>PeriodicReplenishment</code>: review every <strong>T</strong>, order <strong>Q</strong>.</li>
</ul>
</li>
<li><strong>Perishability</strong>: <code>inventory_type</code> for all nodes is <code>perishable</code>, and parameter <code>shelf_life</code> is passed. </li>
</ul>
<h2 id="full-example">Full Example</h2>
<blockquote>
<p>This script constructs a hybrid network with two distributors and five retailers, then runs a short simulation.</p>
</blockquote>
<pre><code class="language-python">
import SupplyNetPy.Components as scm
import simpy
import numpy as np

class Distributions:
    def __init__(self, lam=5, mu=5, low=1, high=10):
        self.lam = lam
        self.mu = mu
        self.low = low
        self.high = high

    def poisson_arrival(self):
        return np.random.exponential(scale=1/self.lam)

    def uniform_quantity(self):
        return int(np.random.uniform(low=self.low, high=self.high))


env = simpy.Environment()

# ------------------- Raw Materials -------------------
flour = scm.RawMaterial(ID='flourk11', name='Flour', extraction_quantity=50,
                        extraction_time=1, mining_cost=10, cost=2.5)

sugar = scm.RawMaterial(ID='sugark21', name='Sugar', extraction_quantity=30,
                        extraction_time=1, mining_cost=8, cost=1.4)

yeast = scm.RawMaterial(ID='yeast31', name='Yeast', extraction_quantity=20,
                        extraction_time=1, mining_cost=3, cost=0.2)

# ------------------- Suppliers -------------------
flour_mill = scm.Supplier(env=env, ID='fmill', name='Flour Mill',
                          node_type='infinite_supplier', raw_material=flour, logging=False)

sugar_factory = scm.Supplier(env=env, ID='sfact', name='Sugar Factory',
                             node_type='infinite_supplier', raw_material=sugar, logging=False)

yeast_factory = scm.Supplier(env=env, ID='yfact', name='Yeast Factory',
                             node_type='infinite_supplier', raw_material=yeast, logging=False)

# ------------------- Manufacturer -------------------
bread = scm.Product(ID='soft_regular11', name='Bread', manufacturing_cost=10, manufacturing_time=1,
                    sell_price=40, raw_materials=[(flour, 30), (sugar, 15), (yeast, 15)], batch_size=300)

bakery = scm.Manufacturer(env=env, ID='bakery', name='Bakery', product=bread, shelf_life=5,
                          inventory_type='perishable', capacity=500, initial_level=100, 
                          inventory_holding_cost=0.5, replenishment_policy=scm.SSReplenishment, 
                          policy_param={'s':300,'S':400}, product_sell_price=35, logging=False)

# ------------------- Distributors -------------------
distributor1 = scm.InventoryNode(env=env, ID='dist1', name='Distributor 1', node_type='distributor', product=bread,
                                 inventory_type='perishable', shelf_life=5,
                                 capacity=float('inf'), initial_level=50, inventory_holding_cost=0.2,
                                 replenishment_policy=scm.RQReplenishment, policy_param={'R':150,'Q':50},
                                 product_buy_price=0, product_sell_price=36, logging=False)

distributor2 = scm.InventoryNode(env=env, ID='dist2', name='Distributor 2', node_type='distributor', product=bread,
                                 inventory_type='perishable', shelf_life=5,
                                 capacity=float('inf'), initial_level=40, inventory_holding_cost=0.25,
                                 replenishment_policy=scm.SSReplenishment, policy_param={'s':150,'S':200},
                                 product_buy_price=0, product_sell_price=37, logging=False)

# ------------------- Retailers -------------------
cake_shops = []
capacities = [40,60,80,60,100]
ini_levels = [30,20,30,20,50]
policies = [scm.RQReplenishment, scm.PeriodicReplenishment, scm.SSReplenishment, scm.RQReplenishment, scm.PeriodicReplenishment]
policy_params = [{'R':20,'Q':40}, {'T':3,'Q':50}, {'s':20,'S':50}, {'R':20,'Q':40}, {'T':3,'Q':100}]
supplier_selection = [scm.SelectFirst,scm.SelectAvailable,scm.SelectFirst,scm.SelectAvailable,scm.SelectFirst]

for i in range(0,5):
    shop = scm.InventoryNode(env=env, ID=f'cake_shop{i+1}', name=f'Cake Shop {i+1}', node_type='retailer', product=bread,
                               inventory_type='perishable', shelf_life=5,
                               capacity=capacities[i], initial_level=ini_levels[i], inventory_holding_cost=0.1,
                               replenishment_policy=policies[i], policy_param=policy_params[i],
                               supplier_selection_policy=supplier_selection[i],
                               product_buy_price=25, product_sell_price=40, logging=False)
    cake_shops.append(shop)

# ------------------- Links -------------------
links = []
# Raw material links, suppliers to bakery
suppliers = [flour_mill, sugar_factory, yeast_factory]
costs = [5, 6, 5]
for i in range(3): 
    links.append(scm.Link(env=env, ID=f'l{i+1}', source=suppliers[i], sink=bakery, cost=costs[i], lead_time=lambda: 0.3))

# Bakery â†’ Distributors
links.append(scm.Link(env=env, ID='l4', source=bakery, sink=distributor1, cost=6, lead_time=lambda: 1))
links.append(scm.Link(env=env, ID='l5', source=bakery, sink=distributor2, cost=7, lead_time=lambda: 1.2))

# Distributor 1 â†’ Shops 1, 2, 3
for i in range(0,3):
    link = scm.Link(env=env, ID=f'l{i+6}', source=distributor1, sink=cake_shops[i], cost=4, lead_time=lambda: 0.4 + i*0.1)
    links.append(link)
# Distributor 2 â†’ Shops 4, 5
for i in range(3,5):
    link = scm.Link(env=env, ID=f'l{i+6}', source=distributor2, sink=cake_shops[i], cost=5, lead_time=lambda: 0.5)
    links.append(link)

# Hybrid cross-links
links.append(scm.Link(env=env, ID='l11', source=distributor1, sink=cake_shops[3], cost=8, lead_time=lambda: 0.5))
links.append(scm.Link(env=env, ID='l12', source=distributor2, sink=cake_shops[4], cost=6, lead_time=lambda: 0.8))

# ------------------- Demands -------------------
arrival = Distributions(lam=5)
quantity = Distributions(low=1, high=5)

demands = []
for i in range(5):
    demands.append(scm.Demand(env=env, ID=f'd{i+1}', name=f'Demand Shop {i+1}', order_arrival_model=arrival.poisson_arrival,
                          order_quantity_model=quantity.uniform_quantity, demand_node=cake_shops[i], logging=False))

# ------------------- Network -------------------
bread_chain = scm.create_sc_net(
    env=env,
    nodes=[flour_mill, sugar_factory, yeast_factory, bakery,
           distributor1, distributor2,
           *cake_shops],
    links=links,
    demands=demands
)

scm.simulate_sc_net(bread_chain, sim_time=365, logging=True)
print(&quot;---- Node-wise performance ----\n---- ---- Suppliers and Bakery---- ----&quot;)
scm.print_node_wise_performance([flour_mill, sugar_factory, yeast_factory, bakery])
print(&quot;\n---- ---- Distributors ---- ----&quot;)
scm.print_node_wise_performance([distributor1, distributor2])
print(&quot;\n---- ---- Retail Shops ---- ----&quot;)
scm.print_node_wise_performance(cake_shops)

</code></pre>
<h2 id="sample-output">Sample Output</h2>
<pre><code>
INFO sim_trace - Supply chain info:
INFO sim_trace - available_inv                     : 534
INFO sim_trace - avg_available_inv                 : 365.46027397260275
INFO sim_trace - avg_cost_per_item                 : 1.8309188338110083
INFO sim_trace - avg_cost_per_order                : 352.90117548464065
INFO sim_trace - backorders                        : [182, 23989]
INFO sim_trace - demand_by_customers               : [9175, 22985]
INFO sim_trace - demand_by_site                    : [436, 1829491]
INFO sim_trace - demands                           : {'d1': Demand Shop 1, 'd2': Demand Shop 2, 'd3': Demand Shop 3, 'd4': Demand Shop 4, 'd5': Demand Shop 5}
INFO sim_trace - env                               : &lt;simpy.core.Environment object at 0x00000278F5714A10&gt;
INFO sim_trace - fulfillment_received_by_customers : [911, 2193]
INFO sim_trace - fulfillment_received_by_site      : [412, 1827149]
INFO sim_trace - inventory_carry_cost              : 59324.19758288176
INFO sim_trace - inventory_spend_cost              : 3056583.0
INFO sim_trace - inventory_waste                   : 25961
INFO sim_trace - links                             : {'l1': fmill to bakery, 'l2': sfact to bakery, 'l3': yfact to bakery, 'l4': bakery to dist1, 'l5': bakery to dist2, 'l6': dist1 to cake_shop1, 'l7': dist1 to cake_shop2, 'l8': dist1 to cake_shop3, 'l9': dist2 to cake_shop4, 'l10': dist2 to cake_shop5, 'l11': dist1 to cake_shop4, 'l12': dist2 to cake_shop5}
INFO sim_trace - nodes                             : {'fmill': Flour Mill, 'sfact': Sugar Factory, 'yfact': Yeast Factory, 'bakery': Bakery, 'dist1': Distributor 1, 'dist2': Distributor 2, 'cake_shop1': Cake Shop 1, 'cake_shop2': Cake Shop 2, 'cake_shop3': Cake Shop 3, 'cake_shop4': Cake Shop 4, 'cake_shop5': Cake Shop 5}
INFO sim_trace - num_distributors                  : 2
INFO sim_trace - num_manufacturers                 : 1
INFO sim_trace - num_of_links                      : 12
INFO sim_trace - num_of_nodes                      : 11
INFO sim_trace - num_retailers                     : 5
INFO sim_trace - num_suppliers                     : 3
INFO sim_trace - profit                            : -2226001.1975828814
INFO sim_trace - revenue                           : 1165732
INFO sim_trace - shortage                          : [8446, 34633]
INFO sim_trace - total_cost                        : 3391733.1975828814
INFO sim_trace - total_demand                      : [9611, 1852476]
INFO sim_trace - total_fulfillment_received        : [1323, 1829342]
INFO sim_trace - transportation_cost               : 2466
---- Node-wise performance ----
---- ---- Suppliers and Bakery---- ----
Performance Metric       Flour Mill               Sugar Factory            Yeast Factory            Bakery
backorder                [0, 0]                   [0, 0]                   [0, 0]                   [132, 22135]
demand_fulfilled         [21, 898260]             [21, 449130]             [21, 449130]             [214, 26936]
demand_placed            [0, 0]                   [0, 0]                   [0, 0]                   [63, 1796520]
demand_received          [21, 898260]             [21, 449130]             [21, 449130]             [228, 29138]
fulfillment_received     [0, 0]                   [0, 0]                   [0, 0]                   [63, 1796520]
inventory_carry_cost     0                        0                        0                        53334.0
inventory_level          0                        0                        0                        500
inventory_spend_cost     0                        0                        0                        2964258.0
inventory_waste          0                        0                        0                        243
node_cost                0                        0                        0                        3291288.0
orders_shortage          [0, 0]                   [0, 0]                   [0, 0]                   [132, 12825]
profit                   2245650.0                628782.0                 89826.0                  -2348528.0
revenue                  2245650.0                628782.0                 89826.0                  942760
total_material_cost      0                        0                        0                        N/A
total_raw_materials_mined0                        0                        0                        N/A
transportation_cost      0                        0                        0                        336

---- ---- Distributors ---- ----
Performance Metric       Distributor 1            Distributor 2
backorder                [26, 805]                [24, 1049]
demand_fulfilled         [60, 1389]               [75, 2304]
demand_placed            [124, 6200]              [104, 22938]
demand_received          [67, 1449]               [78, 2384]
fulfillment_received     [116, 5800]              [98, 21136]
inventory_carry_cost     1165.8018979669055       4439.666173296053
inventory_level          7                        27
inventory_spend_cost     0                        0
inventory_waste          4842                     19345
node_cost                1909.8018979669055       5167.666173296053
orders_shortage          [26, 470]                [24, 691]
profit                   48094.19810203309        80080.33382670395
revenue                  50004                    85248
transportation_cost      744                      728

---- ---- Retail Shops ---- ----
Performance Metric       Cake Shop 1              Cake Shop 2              Cake Shop 3              Cake Shop 4              Cake Shop 5            

backorder                [0, 0]                   [0, 0]                   [0, 0]                   [0, 0]                   [0, 0]                 

demand_fulfilled         [39, 96]                 [239, 555]               [39, 105]                [310, 757]               [284, 680]             

demand_placed            [8, 198]                 [52, 947]                [7, 304]                 [29, 1160]               [49, 1224]             

demand_received          [39, 96]                 [239, 555]               [39, 105]                [310, 757]               [284, 680]             

fulfillment_received     [8, 198]                 [45, 887]                [7, 304]                 [28, 1120]               [47, 1184]             

inventory_carry_cost     9.42778086039718         81.4112372198074         15.98847104347198        148.6863226007502        129.21569989437646     

inventory_level          0                        0                        0                        0                        0                      

inventory_spend_cost     4950                     22175                    7600                     28000                    29600                  

inventory_waste          102                      352                      200                      383                      494                    

node_cost                4991.427780860397        22464.411237219807       7643.988471043472        28293.68632260075        29974.215699894376     

orders_shortage          [1759, 4320]             [1595, 3992]             [1787, 4534]             [1567, 3925]             [1556, 3876]           

profit                   -1151.4277808603974      -264.41123721980694      -3443.9884710434717      1986.3136773992483       -2774.2156998943756    

revenue                  3840                     22200                    4200                     30280                    27200                  

transportation_cost      32                       208                      28                       145                      245 

</code></pre>
<h2 id="suggested-experiments">Suggested Experiments</h2>
<ul>
<li>Vary <code>policy_param</code> values (<code>s/S</code>, <code>R/Q</code>, <code>T/Q</code>).</li>
<li>Change <code>lead_time</code> lambdas and link costs.</li>
<li>Switch retailer <code>inventory_type</code> and <code>shelf_life</code> to study perishability.</li>
<li>Add/remove crossâ€‘links to test resilience.</li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li>Keep node IDs unique.</li>
<li>Ensure <code>product_buy_price</code> â‰¤ upstream <code>product_sell_price</code> where applicable.</li>
<li>Use consistent time units across processing, lead times, and review periods.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../safety_inv_est/" class="btn btn-neutral float-left" title="Estimating Safety Stock"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../case_study_pharma/" class="btn btn-neutral float-right" title="Pharmacy Supply Chain">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../safety_inv_est/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../case_study_pharma/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
